pipeline {
  agent any
	tools {
    maven 'M2_HOME'
  }
  stages {
    stage('Setup parameters') {
      steps {
        script {
          properties([
            parameters([
              choice(
                choices: ['dev', 'qa'],
                name: 'Environment',
                description: 'Which environment?.'
              ),
              string(
                defaultValue: '192.168.1.11',
                name: 'MachineIP',
                description: 'machine ip where test will be executed.',
                trim: true
              ),
							string(
                defaultValue: 'FirstSimulation',
                name: 'SimulationClassFile',
                description: 'The class which is created under simulation package.',
                trim: true
              )
            ])
          ])
        }
      }
    }

    stage('clone performance repo') {
      steps {
        script {
					sh "rm -rf gatling-fw"
          sh "git clone https://github.com/jitendrakumarr/gatling-fw.git"
					sh "pwd"
        }
      }
    }

    stage('goto project dir and install dependancies') {
      steps {
          dir("gatling-fw") {
    			sh "pwd"
					sh "mvn install"
          sh "mvn gatling:test -Dgatling.simulationClass=simulations.${SimulationClassFile}"
				}
      }
    }

    stage('reporting') {
      steps {
        script {
           if (params.Environment == 'qa') {
            sh "echo test"
          }
        }
      }
    }
  }
}