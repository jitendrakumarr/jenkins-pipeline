pipeline {
  agent any
  stages {
    stage('Setup parameters') {
      steps {
        script {
          properties([
            parameters([
              choice(
                choices: ['dev', 'qa'],
                name: 'Environment',
                description: 'Which environment?.'
              ),
              string(
                defaultValue: '1',
                name: 'Machine IP',
                description: 'machine ip where test will be executed.',
                trim: true
              )
            ])
          ])
        }
      }
    }

    stage('clone performance repo') {
      steps {
        script {
					sh "rm -rf gatling-fw"
          sh "git clone https://github.com/jitendrakumarr/gatling-fw.git"
        }
      }
    }

    stage('goto dir and install dependancy') {
      steps {
        script {
          sh "cd gatling-fw"
					withMaven(maven: 'mvn') {
            sh "mvn clean package"
        	}
        }
      }
    }

    stage('start execution') {
      steps {
        script {
					sh "pwd"
					sh "cd gatling-fw"
          sh "mvn gatling:test -Dgatling.simulationClass=com.zepto.simulations.FirstSimulation"
        }
      }
    }

    stage('reporting') {
      steps {
        script {
           if (params.Environment == 'qa') {
            sh "echo test"
          }
        }
      }
    }

  }
}